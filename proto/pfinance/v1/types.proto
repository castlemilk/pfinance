syntax = "proto3";

package pfinance.v1;

import "google/protobuf/timestamp.proto";

// ExpenseCategory represents the category of an expense
enum ExpenseCategory {
  EXPENSE_CATEGORY_UNSPECIFIED = 0;
  EXPENSE_CATEGORY_FOOD = 1;
  EXPENSE_CATEGORY_HOUSING = 2;
  EXPENSE_CATEGORY_TRANSPORTATION = 3;
  EXPENSE_CATEGORY_ENTERTAINMENT = 4;
  EXPENSE_CATEGORY_HEALTHCARE = 5;
  EXPENSE_CATEGORY_UTILITIES = 6;
  EXPENSE_CATEGORY_SHOPPING = 7;
  EXPENSE_CATEGORY_EDUCATION = 8;
  EXPENSE_CATEGORY_TRAVEL = 9;
  EXPENSE_CATEGORY_OTHER = 10;
}

// ExpenseFrequency represents how often an expense occurs
enum ExpenseFrequency {
  EXPENSE_FREQUENCY_UNSPECIFIED = 0;
  EXPENSE_FREQUENCY_ONCE = 1;
  EXPENSE_FREQUENCY_DAILY = 2;
  EXPENSE_FREQUENCY_WEEKLY = 3;
  EXPENSE_FREQUENCY_FORTNIGHTLY = 4;
  EXPENSE_FREQUENCY_MONTHLY = 5;
  EXPENSE_FREQUENCY_QUARTERLY = 6;
  EXPENSE_FREQUENCY_ANNUALLY = 7;
}

// IncomeFrequency represents how often income is received
enum IncomeFrequency {
  INCOME_FREQUENCY_UNSPECIFIED = 0;
  INCOME_FREQUENCY_WEEKLY = 1;
  INCOME_FREQUENCY_FORTNIGHTLY = 2;
  INCOME_FREQUENCY_MONTHLY = 3;
  INCOME_FREQUENCY_ANNUALLY = 4;
}

// TaxStatus represents whether income is pre or post tax
enum TaxStatus {
  TAX_STATUS_UNSPECIFIED = 0;
  TAX_STATUS_PRE_TAX = 1;
  TAX_STATUS_POST_TAX = 2;
}

// TaxCountry represents supported tax systems
enum TaxCountry {
  TAX_COUNTRY_UNSPECIFIED = 0;
  TAX_COUNTRY_AUSTRALIA = 1;
  TAX_COUNTRY_UK = 2;
  TAX_COUNTRY_SIMPLE = 3;
}

// User represents a user in the system
message User {
  string id = 1;
  string email = 2;
  string display_name = 3;
  google.protobuf.Timestamp created_at = 4;
  google.protobuf.Timestamp updated_at = 5;
  string photo_url = 6;
}

// SplitType represents how an expense is split among members
enum SplitType {
  SPLIT_TYPE_UNSPECIFIED = 0;
  SPLIT_TYPE_EQUAL = 1; // Split equally among all allocated members
  SPLIT_TYPE_PERCENTAGE = 2; // Split by percentage
  SPLIT_TYPE_AMOUNT = 3; // Split by fixed amounts
  SPLIT_TYPE_SHARES = 4; // Split by shares (e.g., 2 shares for one person, 1 for another)
}

// ExpenseAllocation represents how much a specific member owes for an expense
message ExpenseAllocation {
  string user_id = 1;
  double amount = 2; // Calculated amount this user owes
  double percentage = 3; // If split by percentage
  double shares = 4; // If split by shares
  bool is_paid = 5; // Whether this allocation has been settled
  google.protobuf.Timestamp paid_at = 6;
}

// Expense represents a single expense entry
message Expense {
  string id = 1;
  string user_id = 2; // User who created/paid for the expense
  string group_id = 3; // Optional - if part of a group
  string description = 4;
  double amount = 5;
  ExpenseCategory category = 6;
  ExpenseFrequency frequency = 7;
  google.protobuf.Timestamp date = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
  
  // New fields for expense allocation
  string paid_by_user_id = 11; // Who actually paid (defaults to user_id)
  SplitType split_type = 12; // How the expense is split
  repeated ExpenseAllocation allocations = 13; // Member allocations
  bool is_settled = 14; // Whether all allocations have been settled
  repeated string tags = 15; // Optional tags for filtering/grouping
}

// Income represents a single income entry
message Income {
  string id = 1;
  string user_id = 2;
  string group_id = 3; // Optional - if part of a group
  string source = 4;
  double amount = 5;
  IncomeFrequency frequency = 6;
  TaxStatus tax_status = 7;
  repeated Deduction deductions = 8;
  google.protobuf.Timestamp date = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}

// Deduction represents a tax deduction
message Deduction {
  string id = 1;
  string name = 2;
  double amount = 3;
  bool is_tax_deductible = 4;
}

// TaxSettings represents user's tax configuration
message TaxSettings {
  bool include_super = 1;
  double super_rate = 2;
  bool include_medicare = 3;
  bool medicare_exemption = 4;
  bool include_senior_offset = 5;
  bool include_student_loan = 6;
  double student_loan_rate = 7;
  bool include_dependent_children = 8;
  bool include_spouse = 9;
  bool include_private_health = 10;
  bool include_voluntary_super = 11;
}

// TaxConfig represents the tax configuration for a user or group
message TaxConfig {
  bool enabled = 1;
  TaxCountry country = 2;
  double tax_rate = 3;
  bool include_deductions = 4;
  TaxSettings settings = 5;
}

// FinanceGroup represents a shared finance tracking group
message FinanceGroup {
  string id = 1;
  string name = 2;
  string description = 3;
  string owner_id = 4;
  repeated string member_ids = 5;
  repeated GroupMember members = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
}

// GroupMember represents a member of a finance group
message GroupMember {
  string user_id = 1;
  string email = 2;
  string display_name = 3;
  GroupRole role = 4;
  google.protobuf.Timestamp joined_at = 5;
}

// GroupRole represents the role of a member in a group
enum GroupRole {
  GROUP_ROLE_UNSPECIFIED = 0;
  GROUP_ROLE_VIEWER = 1;
  GROUP_ROLE_MEMBER = 2;
  GROUP_ROLE_ADMIN = 3;
  GROUP_ROLE_OWNER = 4;
}

// GroupInvitation represents an invitation to join a group
message GroupInvitation {
  string id = 1;
  string group_id = 2;
  string inviter_id = 3;
  string invitee_email = 4;
  GroupRole role = 5;
  InvitationStatus status = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp expires_at = 8;
}

// InvitationStatus represents the status of an invitation
enum InvitationStatus {
  INVITATION_STATUS_UNSPECIFIED = 0;
  INVITATION_STATUS_PENDING = 1;
  INVITATION_STATUS_ACCEPTED = 2;
  INVITATION_STATUS_DECLINED = 3;
  INVITATION_STATUS_EXPIRED = 4;
}

// BudgetPeriod represents the time period for a budget
enum BudgetPeriod {
  BUDGET_PERIOD_UNSPECIFIED = 0;
  BUDGET_PERIOD_WEEKLY = 1;
  BUDGET_PERIOD_FORTNIGHTLY = 2;
  BUDGET_PERIOD_MONTHLY = 3;
  BUDGET_PERIOD_QUARTERLY = 4;
  BUDGET_PERIOD_YEARLY = 5;
}

// Budget represents a budget configuration
message Budget {
  string id = 1;
  string user_id = 2;
  string group_id = 3; // Optional - if part of a group
  string name = 4;
  string description = 5;
  double amount = 6;
  BudgetPeriod period = 7;
  repeated ExpenseCategory category_ids = 8; // Categories this budget applies to
  bool is_active = 9;
  google.protobuf.Timestamp start_date = 10;
  google.protobuf.Timestamp end_date = 11; // Optional - for fixed period budgets
  google.protobuf.Timestamp created_at = 12;
  google.protobuf.Timestamp updated_at = 13;
}

// BudgetAlert represents an alert configuration for a budget
message BudgetAlert {
  string id = 1;
  string budget_id = 2;
  double threshold_percentage = 3; // e.g., 50, 80, 90, 100
  bool is_enabled = 4;
  google.protobuf.Timestamp last_triggered_at = 5;
}

// BudgetProgress represents the current progress of a budget
message BudgetProgress {
  string budget_id = 1;
  double allocated_amount = 2;
  double spent_amount = 3;
  double remaining_amount = 4;
  double percentage_used = 5;
  int32 days_remaining = 6;
  google.protobuf.Timestamp period_start = 7;
  google.protobuf.Timestamp period_end = 8;
  repeated ExpenseBreakdown category_breakdown = 9;
}

// ExpenseBreakdown represents spending breakdown by category
message ExpenseBreakdown {
  ExpenseCategory category = 1;
  double amount = 2;
  double percentage = 3;
}

// MemberBalance represents a member's balance in a group
message MemberBalance {
  string user_id = 1;
  string group_id = 2;
  double total_paid = 3; // Total amount paid by this member
  double total_owed = 4; // Total amount allocated to this member
  double balance = 5; // total_paid - total_owed (positive means owed money, negative means owes money)
  repeated MemberDebt debts = 6; // Detailed debts to/from other members
}

// MemberDebt represents money owed between two members
message MemberDebt {
  string from_user_id = 1; // Who owes money
  string to_user_id = 2; // Who is owed money
  double amount = 3;
  int32 expense_count = 4; // Number of expenses contributing to this debt
}

// GroupInviteLink represents a shareable link to join a group
message GroupInviteLink {
  string id = 1;
  string group_id = 2;
  string code = 3;  // Short 8-char shareable code
  string created_by = 4;
  GroupRole default_role = 5;
  int32 max_uses = 6;
  int32 current_uses = 7;
  google.protobuf.Timestamp expires_at = 8;
  bool is_active = 9;
  google.protobuf.Timestamp created_at = 10;
}

// ExpenseContribution represents a personal expense contributed to a group
message ExpenseContribution {
  string id = 1;
  string source_expense_id = 2;  // Original personal expense
  string target_group_id = 3;
  string contributed_by = 4;
  double amount = 5;  // Amount contributed (could be partial)
  SplitType split_type = 6;
  repeated ExpenseAllocation allocations = 7;
  string created_group_expense_id = 8;  // Resulting group expense
  google.protobuf.Timestamp contributed_at = 9;
}

// IncomeContribution represents personal income contributed to a group
message IncomeContribution {
  string id = 1;
  string source_income_id = 2;  // Original personal income
  string target_group_id = 3;
  string contributed_by = 4;
  double amount = 5;  // Amount contributed (could be partial)
  string created_group_income_id = 6;  // Resulting group income
  google.protobuf.Timestamp contributed_at = 7;
}